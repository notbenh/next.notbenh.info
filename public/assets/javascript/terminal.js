// Generated by CoffeeScript 1.6.3
var Action, ActionSet, Terminal,
  __bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; },
  __slice = [].slice;

ActionSet = (function() {
  function ActionSet(name, actions) {
    var data;
    this.name = name;
    this.help = __bind(this.help, this);
    this._merge = __bind(this._merge, this);
    this.rm = __bind(this.rm, this);
    this["do"] = __bind(this["do"], this);
    if (actions !== void 0) {
      for (name in actions) {
        data = actions[name];
        this.add.apply(this, [name].concat(__slice.call(data)));
      }
    }
  }

  ActionSet.prototype.actions = {};

  ActionSet.prototype["do"] = function() {
    var args, c_action, result, verb, _i, _len, _ref;
    args = arguments.length === 1 ? arguments[0].split(' ') : Array.prototype.slice.call(arguments);
    verb = args.shift();
    if (arguments.length === 1) {
      args = args.join(' ');
    }
    if (this.actions[verb] === void 0) {
      console.error(verb, this.help(verb));
      throw 'umm';
    }
    result = this.actions[verb].action(args);
    _ref = this._custom_actions;
    for (_i = 0, _len = _ref.length; _i < _len; _i++) {
      c_action = _ref[_i];
      result = c_action(result);
    }
    return result;
  };

  ActionSet.prototype.add = function() {
    var name, opts;
    name = arguments[0], opts = 2 <= arguments.length ? __slice.call(arguments, 1) : [];
    return this.actions[name] = (function(func, args, ctor) {
      ctor.prototype = func.prototype;
      var child = new ctor, result = func.apply(child, args);
      return Object(result) === result ? result : child;
    })(Action, [name].concat(__slice.call(opts)), function(){});
  };

  ActionSet.prototype._custom_actions = [];

  ActionSet.prototype.rm = function() {};

  ActionSet.prototype._merge = function() {};

  ActionSet.prototype.help = function(verb) {
    var action, buffer, content, content_item, name, names, title, _i, _j, _len, _len1, _ref;
    buffer = '';
    if (verb && this.actions[verb] === void 0) {
      buffer += "[[b;#F00;;]ERROR:] [[b;;;]" + verb + "] is not a known verb.\n\n";
      verb = void 0;
    }
    if (verb === void 0) {
      buffer += "for more help with any of these actions, just ask for help action for even more information. \n";
      buffer += "here are a all the known actions: \n";
      names = ((function() {
        var _results;
        _results = [];
        for (name in this.actions) {
          _results.push(name);
        }
        return _results;
      }).call(this)).sort();
      for (_i = 0, _len = names.length; _i < _len; _i++) {
        name = names[_i];
        action = this.actions[name];
        if (action.note.length > 0) {
          buffer += "  [[b;;;]" + action.name + "]: " + action.note + "\n";
        }
      }
      return buffer;
    }
    action = this.actions[verb];
    if (action.note.length > 0 || action.docs) {
      buffer += "" + action.name + ":\n";
      if (action.note.length >= 0) {
        buffer += "  " + action.note + "\n";
      }
      _ref = action.docs;
      for (title in _ref) {
        content = _ref[title];
        if (Array.isArray(content)) {
          buffer += "  " + title + ":\n";
          for (_j = 0, _len1 = content.length; _j < _len1; _j++) {
            content_item = content[_j];
            buffer += "    " + content_item + "\n";
          }
        } else {
          buffer += "  " + title + ": " + content + "\n";
        }
      }
      return buffer;
    }
  };

  return ActionSet;

})();

Action = (function() {
  function Action(name, action, note, docs) {
    this.name = name;
    this.action = action;
    this.note = note != null ? note : '';
    this.docs = docs != null ? docs : {};
  }

  return Action;

})();

Terminal = (function() {
  function Terminal(id, options, actions) {
    this.id = id;
    this.options = options;
    this._preform_action = __bind(this._preform_action, this);
    this.element = $(this.id).terminal(this._preform_action, this.options);
    this.actions = actions !== void 0 ? new ActionSet('instance', actions) : new ActionSet('instance');
  }

  Terminal.prototype._preform_action = function(command, term) {
    var e, find, h, match, re, _ref;
    if (/^\!/.test(command)) {
      find = /\!+(.*)/.exec(command)[1];
      term.history().data().pop();
      h = term.history().data();
      re = RegExp(find);
      command = term.history().data().reverse().filter(function(i) {
        return re.exec(i);
      })[0] || command;
      term.echo(command);
    }
    if (command === '') {
      term.echo('');
    } else if (command === 'history') {
      term.echo(term.history().data().join("\n"));
    } else if (/^help/.test(command)) {
      match = /^help\s*(\w+)?/.exec(command);
      term.echo(this.actions.help(match[1]));
    } else {
      try {
        term.echo((_ref = this.actions["do"](command)) != null ? _ref : '');
      } catch (_error) {
        e = _error;
        term.error(e != null ? e : 'oops');
        if (e.length === 0) {
          term.echo(this.actions.help(command));
        }
      }
    }
  };

  Terminal.prototype._add_action = function(name, action, note, docs) {
    var data, _ref, _results;
    if (typeof name === 'object') {
      _results = [];
      for (name in name) {
        data = name[name];
        _results.push((_ref = this.actions).add.apply(_ref, [name].concat(__slice.call(data))));
      }
      return _results;
    } else {
      return this.actions.add(name, action, note, docs);
    }
  };

  return Terminal;

})();
